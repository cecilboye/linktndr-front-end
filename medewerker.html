<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medewerker!</title>
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.rtl.min.css"/>
    <link rel="stylesheet" href="./bootstrap/css/bootstrap-grid.min.css"/>
    <link rel="stylesheet" href="./includes/globalstyle.css"/>
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="./bootstrap/js/bootstrap.min.js"></script>
    <script src="includes/globalscript.js"></script>
</head>
<body>
    <div id="header"></div>
    <div class="container">
        <div class="row">
            <div class="col-sm-5">
                <br>
                <h1 style="text-align: center;">Mijn Profiel</h1>
                <br>
                <div class="row">
                    <label for="NameElement" class="col-sm-4">Naam:</label>
                    <div class="col-sm-8"><p id="NameElement"></p></div>
                </div>
                <div class="row">
                    <label for="DateOfBirthElement" class="col-sm-4">Leeftijd:</label>
                    <div class="col-sm-8"><p id="DateOfBirthElement"></p></div>
                </div>
                <div class="row">
                    <label for="PostCodeElement" class="col-sm-4">Postcode:</label>
                    <div class="col-sm-8"><p id="PostCodeElement"></p></div>
                </div>
                <div class="row">
                    <label for="HouseNumberElement" class="col-sm-4">Huisnummer:</label>
                    <div class="col-sm-8"><p id="HouseNumberElement"></p></div>
                </div>
                <div class="row">
                    <label for="EmailElement" class="col-sm-4">Emailadres:</label>
                    <div class="col-sm-8"><p id="EmailElement"></p></div>
                </div>
                <div class="row">
                    <label for="TelephoneElement" class="col-sm-4">Telefoonnummer:</label>
                    <div class="col-sm-8"><p id="TelephoneElement"></p></div>
                </div>
                <div class="row">
                    <label for="TalentmanagerElement" class="col-sm-4">Talentmanager:</label>
                    <div class="col-sm-8"><p id="TalentmanagerElement"></p></div>
                </div>
                <div class="row">
                    <label for="RadiusElement" class="col-sm-4">Afstandvoorkeur:</label>
                    <div class="col-sm-8"><p id="RadiusElement"></p></div>
                </div>
                <div class="row">
                    <label for="SpecializationElement" class="col-sm-4">Uitstroomrichting:</label>
                    <div class="col-sm-8"><p id="SpecializationElement"></p></div>
                </div>
                <div class="row">
                    <label for="BioElement" class="col-sm-4">Bio:</label>
                    <div class="col-sm-8"><p id="BioElement"></p></div>
                </div>
                <div class="row">
                    <!--<button type="submit" class="btn btn-default btn-outline-primary" onclick="submitForm(event)">Bewerk</button>-->
                    <button type="button" class="btn btn-primary col-sm-12" data-bs-toggle="modal" data-bs-target="#EditModal" data-bs-id="@mdo">Bewerk</button>
                </div>
                <div class="modal fade" id="EditModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Bewerk gegevens</h5>
                          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group row">
                                    <label for="firstname" class="col-sm-10">Naam:</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="NameInput" placeholder="Voornaam Achternaam"/>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="DateOfBirth" class="col-sm-10">Geboortedatum:</label>
                                    <div class="col-sm-12">
                                        <input type="date" class="form-control" id="DateOfBirthInput" placeholder="27-11-1997"/>
                                    </div>
                                    
                                </div>
                                <div class="form-group row">
                                    <label for="PostCode" class="col-sm-10">Postcode:</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="PostCodeInput" placeholder="6969HH"/>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="HouseNumber" class="col-sm-10">Huisnummer:</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="HouseNumberInput" placeholder="69a"/>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="email" class="col-sm-10">Emailadres:</label>
                                    <div class="col-sm-12">
                                        <input type="email" class="form-control" id="EmailInput" placeholder="email@email.nl"/>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="telephone" class="col-sm-10">Telefoonnummer:</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="TelephoneInput" placeholder="0669696969"/>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="Talentmanager" class="col-sm-10">Talentmanager:</label>
                                    <div class="col-sm-12">
                                        <select class="form-control"  id="TalentmanagerInput">
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="radius" class="col-sm-10">Afstand voorkeur: <span id="RangeValue">50</span>km</label>
                                    <div class="col-sm-12">
                                        <input type="range" class="form-control" id="RadiusInput" min="10" max="200" value="50" oninput="showValue(this.value)" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="uitstroomrichting" class="col-sm-10">Uitstroomrichting:</label>
                                    <div class="col-sm-12">
                                        <select class="form-control"  id="SpecializationInput">
                                            <option value="" disabled selected>Selecteer je uitstroomrichting:</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="bio" class="col-sm-10">Bio:</label>
                                    <div class="col-sm-12">
                                        <textarea class="form-control" name="bio" id="BioInput" cols="30" rows="10" placeholder="Vul hier een korte beschrijving van jezelf in"><p id="profileText"></p></textarea>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="image" class="col-sm-10">Foto:</label>
                                    <div class="col-sm-12">
                                        <input  type="text" class="form-control" id="PhotoInput" placeholder="Vul hier een URL van een foto die je wilt uploaden"/>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="password" class="col-sm-10">password:</label>
                                    <div class="col-sm-12">
                                        <input type="password" class="form-control" id="PasswordInput" placeholder="P@55W0RD!" required/>
                                    </div>
                                </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Sluiten</button>
                          <button type="button" class="btn btn-primary" onclick="submitForm(event)">Opslaan</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
            </div>
            <div class="col-sm-1"></div>
            <div class="col-sm-4 align-self-center">                
                <div class="row">
                    <div class="col-sm-12"><img src="" id="PhotoElement" class="img-thumbnail"/></div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer"></div>
    <script>
        onPageLoad((loggedInUser) => {
            if(localStorage.getItem('UserType') != 'MEDEWERKER'){
                window.location.href = "./index.html";
            }
            fetch(URL+'medewerker/'+loggedInUser.id)
            .then(response => response.json())
            .then(userData => {
                //get all talentmanagers and put them in select tag as options
                let element = document.getElementById("TalentmanagerInput");
                fetch(URL+'Talentmanager')
                .then(response => response.json())
                .then(fetchdata => {
                    // Create option elements and add them to the select element
                    fetchdata.forEach(item => {
                        const option = document.createElement("option");
                        option.text = item.name;
                        option.value = item.id;
                        if(item.id == userData.talentManagerId){
                            option.selected = "selected";
                        }
                        element.add(option);
                    });
                })
                .catch(error => console.error(error));

                //get all specialization values and put them in a select tag as options
                let SpecializationSelectElement = document.getElementById("SpecializationInput");
                fetch(URL+'Specialization')
                .then(response => response.json())
                .then(fetchdata => {
                    // Create option elements and add them to the select element
                    let i = 0;
                    for (var key in fetchdata) {
                        const option = document.createElement("option");
                        option.text = fetchdata[key];
                        option.value = key;
                        if(i == userData.uitstroomrichting){
                            option.selected = "selected";
                            document.getElementById("SpecializationElement").innerHTML = fetchdata[key];
                        }
                        SpecializationSelectElement.add(option);
                        i++;
                    }
                })
                .catch(error => console.error(error));

                document.getElementById("PhotoElement").src = userData.photo;
                document.getElementById('NameElement').innerHTML = userData.name;
                //document.getElementById("DateOfBirthElement").innerHTML = new Date(userData.dateOfBirth).toISOString().substring(0, 10);
                document.getElementById("DateOfBirthElement").innerHTML = getAge(userData.dateOfBirth);
                document.getElementById("PostCodeElement").innerHTML = userData.postCode;
                document.getElementById("HouseNumberElement").innerHTML = userData.houseNumber;
                document.getElementById("EmailElement").innerHTML = userData.email;
                document.getElementById("TelephoneElement").innerHTML = userData.telephone;
                document.getElementById("TalentmanagerElement").innerHTML = userData.talentManagerName;
                document.getElementById("RadiusElement").innerHTML = userData.radius;
                document.getElementById("BioElement").innerHTML = userData.profileText;

                document.getElementById("NameInput").value = userData.name;
                document.getElementById("DateOfBirthInput").value = new Date(userData.dateOfBirth).toISOString().substring(0, 10);
                document.getElementById("PostCodeInput").value = userData.postCode;
                document.getElementById("HouseNumberInput").value = userData.houseNumber;
                document.getElementById("EmailInput").value = userData.email;
                document.getElementById("TelephoneInput").value = userData.telephone;
                document.getElementById("RadiusInput").value = userData.radius;
                document.getElementById("RangeValue").innerHTML = userData.radius;
                document.getElementById("BioInput").value = userData.profileText;
                document.getElementById("PhotoInput").value = userData.photo;
                document.getElementById("PasswordInput").value = userData.Password;
            })
        })
        
        function submitForm(e) {
            e.preventDefault();
            // Get form data
            let dob = new Date(document.getElementById("DateOfBirthInput").value);
            dob.setHours(12,0,0,0);
            const updateddata = {
                Name: document.getElementById("NameInput").value,
                DateOfBirth: dob.toISOString(),
                PostCode: document.getElementById("PostCodeInput").value,
                HouseNumber: document.getElementById("HouseNumberInput").value,
                Email: document.getElementById("EmailInput").value,
                Password: document.getElementById("PasswordInput").value,
                Telephone: document.getElementById("TelephoneInput").value,
                Radius: document.getElementById("RadiusInput").value,
                Uitstroomrichting: document.getElementById("SpecializationInput").value,
                Photo: document.getElementById("PhotoInput").value,
                ProfileText: document.getElementById("BioInput").value,
                TalentManagerId: document.getElementById("TalentmanagerInput").value
            }
            console.log(updateddata);
            // Send data as JSON to backend URL using Fetch API
            fetch(URL+'Medewerker/update/'+localStorage.getItem('UserId'), {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updateddata)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok:'+ JSON.stringify(response));
                }
                return response.json();
            })
            .then(data => {
                if(data){
                    window.location.href = "./medewerker.html";
                    //document.getElementById("submitinfo").innerHTML = 'registratie succesvol afgerond. <a href="./">klik hier</a> om naar de inlog pagina te gaan.';
                }
            })
            .catch(error => console.error(error));
        }
        //show value above radius input
        function showValue(value) {
            document.getElementById("RangeValue").innerHTML = value;
        }
        function getAge(dateString) {
            var today = new Date();
            var birthDate = new Date(dateString);
            var age = today.getFullYear() - birthDate.getFullYear();
            var m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }
    </script>
</body>

</html>